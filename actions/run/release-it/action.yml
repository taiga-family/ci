name: Action for release
description: Action for release

inputs:
  ref:
    description: GitHub ref
    required: true
  githubToken:
    description: GitHub token
    required: true
  npmToken:
    description: NPM token
    required: true
  forcePush:
    description: GitHub token
    required: true
  mode:
    description: NPM token
    required: true

runs:
  using: composite
  steps:
    - uses: ./actions/setup/checkout
      with:
        token: ${{ inputs.githubToken }}
        ref: ${{ inputs.ref }}
        fetch-depth: 0
    - uses: ./actions/setup/variables
    - uses: ./actions/setup/node
    - uses: ./actions/setup/config/git
      with:
        token: ${{ inputs.githubToken }}
    - uses: ./actions/setup/config/npm
      with:
        token: ${{ inputs.npmToken }}

    - shell: bash
      run: |
        export GITHUB_TOKEN="${{ inputs.githubToken }}"

        if [[ "${{ inputs.forcePush }}" == "true" ]]; then

          if [[ "${{ inputs.mode }}" != "prepatch" ]]; then
              npx release-it "${{ inputs.mode }}" --increment --ci
          else
              npx release-it --preRelease=alpha --ci
          fi

        else
            npx release-it --increment --ci
        fi
